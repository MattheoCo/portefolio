<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title }}</title>
  
  <!-- Import map pour Three.js -->
  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
      }
    }
  </script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    body{margin:0;background:linear-gradient(135deg,#fafafa 0%,#f0f0f0 50%,#ffffff 100%);color:#2c2c2c;font-family:'Inter',sans-serif;min-height:100vh}
    .container{max-width:1400px;margin:0 auto;padding:40px 20px}
    
    /* Header */
    .header{text-align:center;margin-bottom:60px}
    .title{font-size:3.2em;color:#b8860b;margin:0;font-family:'Playfair Display',serif;font-weight:700;text-shadow:0 2px 10px rgba(184,134,11,0.2)}
    .subtitle{color:#666666;margin-top:16px;font-size:1.2em;font-weight:300;letter-spacing:0.5px}
    
    /* Navigation */
    .nav{margin-bottom:50px}
    .nav-link{color:#b8860b;text-decoration:none;background:rgba(184,134,11,0.05);padding:14px 28px;border-radius:6px;border:1px solid rgba(184,134,11,0.2);transition:all 0.3s;font-weight:500;letter-spacing:0.3px}
    .nav-link:hover{background:rgba(184,134,11,0.1);border-color:rgba(184,134,11,0.4);transform:translateY(-1px);box-shadow:0 4px 15px rgba(184,134,11,0.15)}
    
    /* Layout en colonnes */
    .projects-layout{display:grid;grid-template-columns:380px 1fr;gap:50px;align-items:start}
    
    /* Sidebar avec liste */
    .projects-sidebar{
      background:linear-gradient(145deg,#ffffff,#f8f8f8);
      border-radius:16px;
      padding:35px;
      border:1px solid rgba(184,134,11,0.15);
      position:sticky;
      top:20px;
      box-shadow:0 10px 40px rgba(0,0,0,0.08);
    }
    
    .sidebar-title{
      color:#b8860b;
      font-size:1.4em;
      margin:0 0 30px;
      border-bottom:2px solid rgba(184,134,11,0.3);
      padding-bottom:12px;
      font-family:'Playfair Display',serif;
      font-weight:600;
    }
    
    .project-list{
      list-style:none;
      padding:0;
      margin:0;
    }
    
    .project-item{
      padding:18px;
      margin-bottom:12px;
      background:linear-gradient(145deg,#ffffff,#f5f5f5);
      border-radius:10px;
      border-left:3px solid transparent;
      cursor:pointer;
      transition:all 0.4s cubic-bezier(0.25,0.46,0.45,0.94);
      border:1px solid rgba(200,200,200,0.3);
    }
    
    .project-item:hover,
    .project-item.active{
      border-left-color:#b8860b;
      background:linear-gradient(145deg,#fefefe,#f8f8f8);
      transform:translateX(8px);
      box-shadow:0 8px 25px rgba(184,134,11,0.15);
      border-color:rgba(184,134,11,0.2);
    }
    
    .project-name{
      color:#b8860b;
      font-weight:600;
      margin-bottom:6px;
      font-size:1.05em;
    }
    
    .project-type{
      color:#8b6914;
      font-size:0.85em;
      font-weight:300;
      text-transform:uppercase;
      letter-spacing:0.8px;
    }
    
    /* Zone de contenu principal */
    .project-content{
      background:linear-gradient(145deg,#ffffff,#f8f8f8);
      border-radius:16px;
      padding:45px;
      border:1px solid rgba(184,134,11,0.15);
      min-height:550px;
      box-shadow:0 10px 40px rgba(0,0,0,0.08);
    }
    
    .content-project{
      display:none;
    }
    
    .content-project.active{
      display:block;
      animation:fadeIn 0.4s ease;
    }
    
    @keyframes fadeIn{
      from{opacity:0;transform:translateY(10px)}
      to{opacity:1;transform:translateY(0)}
    }
    
    .content-title{
      color:#b8860b;
      font-size:2.5em;
      margin:0 0 20px;
      display:flex;
      align-items:center;
      gap:20px;
      font-family:'Playfair Display',serif;
      font-weight:700;
    }
    
    .content-icon{
      font-size:1.1em;
    }
    
    .content-meta{
      display:flex;
      gap:15px;
      margin-bottom:35px;
      flex-wrap:wrap;
    }
    
    .meta-item{
      background:linear-gradient(135deg,rgba(184,134,11,0.1),rgba(139,105,20,0.05));
      color:#8b6914;
      padding:10px 18px;
      border-radius:25px;
      font-size:0.9em;
      border:1px solid rgba(184,134,11,0.2);
      font-weight:500;
      letter-spacing:0.3px;
    }
    
    .content-description{
      line-height:1.9;
      margin-bottom:35px;
      font-size:1.1em;
      color:#333333;
      font-weight:300;
    }
    
    .content-features{
      margin-bottom:35px;
    }
    
    .features-title{
      color:#b8860b;
      font-size:1.3em;
      margin-bottom:18px;
      font-family:'Playfair Display',serif;
      font-weight:600;
    }
    
    .features-list{
      list-style:none;
      padding:0;
    }
    
    .features-list li{
      padding:12px 0;
      border-bottom:1px solid rgba(200,200,200,0.4);
      color:#555555;
      font-weight:300;
    }
    
    .features-list li:before{
      content:"‚óÜ ";
      color:#b8860b;
      font-weight:bold;
      margin-right:8px;
    }
    
    .content-links{
      display:flex;
      gap:18px;
      flex-wrap:wrap;
    }
    
    .content-link{
      color:#333333;
      text-decoration:none;
      background:linear-gradient(135deg,rgba(184,134,11,0.1),rgba(139,105,20,0.05));
      padding:14px 24px;
      border-radius:8px;
      border:1px solid rgba(184,134,11,0.25);
      transition:all 0.3s;
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:500;
    }
    
    .content-link:hover{
      background:linear-gradient(135deg,rgba(184,134,11,0.2),rgba(139,105,20,0.1));
      border-color:rgba(184,134,11,0.4);
      transform:translateY(-2px);
      box-shadow:0 6px 20px rgba(184,134,11,0.15);
    }

    /* WebGL stage placeholder */
    .webgl-stage{
      background:linear-gradient(145deg,#ffffff,#f8f8f8);
      border:1px solid rgba(184,134,11,0.2);
      border-radius:12px;
      height:320px;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 10px 30px rgba(0,0,0,0.08);
      position:relative;
    }
    .webgl-stage-placeholder{
      color:#8b6914;
      font-weight:600;
      letter-spacing:0.3px;
      opacity:0.8;
    }
    .webgl-stage canvas{
      width:100%;
      height:100%;
      display:block;
      border-radius:12px;
    }
    
    /* Menu de chargement WebGL */
    .webgl-loader-overlay{
      position:absolute;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background:linear-gradient(145deg,rgba(255,255,255,0.98),rgba(248,248,248,0.98));
      backdrop-filter:blur(10px);
      border-radius:12px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:40px;
      text-align:center;
      z-index:10;
      transition:opacity 0.4s ease,visibility 0.4s ease;
    }
    .webgl-loader-overlay.hidden{
      opacity:0;
      visibility:hidden;
      pointer-events:none;
    }
    .webgl-loader-icon{
      font-size:3.5em;
      margin-bottom:20px;
      animation:float 3s ease-in-out infinite;
    }
    @keyframes float{
      0%,100%{transform:translateY(0)}
      50%{transform:translateY(-10px)}
    }
    .webgl-loader-title{
      font-size:1.8em;
      color:#b8860b;
      font-weight:700;
      margin-bottom:15px;
      font-family:'Playfair Display',serif;
    }
    .webgl-loader-warning{
      background:linear-gradient(135deg,rgba(255,193,7,0.15),rgba(255,152,0,0.1));
      border:1px solid rgba(255,193,7,0.3);
      border-radius:8px;
      padding:15px 20px;
      margin:20px 0;
      color:#8b6914;
      font-size:0.95em;
      line-height:1.6;
      max-width:450px;
    }
    .webgl-loader-warning-icon{
      font-size:1.2em;
      margin-right:8px;
      vertical-align:middle;
    }
    .webgl-load-button{
      background:linear-gradient(135deg,#b8860b,#8b6914);
      color:#ffffff;
      border:none;
      padding:16px 40px;
      border-radius:30px;
      font-size:1.1em;
      font-weight:600;
      cursor:pointer;
      transition:all 0.3s ease;
      box-shadow:0 4px 15px rgba(184,134,11,0.3);
      margin-top:10px;
      font-family:'Inter',sans-serif;
    }
    .webgl-load-button:hover{
      transform:translateY(-2px);
      box-shadow:0 6px 25px rgba(184,134,11,0.4);
      background:linear-gradient(135deg,#c49a1a,#9a7515);
    }
    .webgl-load-button:active{
      transform:translateY(0);
    }
    
    /* Section comp√©tences en bas */
    .skills-section{
      background:linear-gradient(145deg,#ffffff,#f8f8f8);
      border-radius:16px;
      padding:45px;
      margin-top:60px;
      border:1px solid rgba(184,134,11,0.15);
      grid-column:1/-1;
      box-shadow:0 10px 40px rgba(0,0,0,0.08);
    }
    
    .skills-title{
      color:#b8860b;
      font-size:2.2em;
      margin:0 0 35px;
      text-align:center;
      font-family:'Playfair Display',serif;
      font-weight:700;
    }
    
    .skills-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));
      gap:28px 32px;
      justify-content:center;
      align-items:start;
    }
    
    .skill-block{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
      min-width:160px;
    }
    
    .skill-tag{
      background:linear-gradient(135deg,#ffffff,#f5f5f5);
      color:#444444;
      padding:12px 20px;
      border-radius:20px;
      border:1px solid rgba(200,200,200,0.5);
      transition:all 0.3s;
      font-size:0.95em;
      font-weight:400;
      letter-spacing:0.3px;
      margin-bottom:0;
    }
    
    .skill-bar{
      width:100%;
      height:10px;
      background:linear-gradient(90deg,#f5f5f5 60%,#e8e8e8 100%);
      border-radius:6px;
      border:1px solid #e0e0e0;
      overflow:hidden;
      margin-top:2px;
      box-shadow:0 1px 4px rgba(184,134,11,0.07);
    }
    
    .skill-bar-fill{
      height:100%;
      background:linear-gradient(90deg,#b8860b 60%,#8b6914 100%);
      border-radius:6px 0 0 6px;
      transition:width 1s cubic-bezier(.77,0,.18,1);
    }
    
    /* Responsive */
    @media(max-width:1024px){
      .projects-layout{grid-template-columns:1fr;gap:30px}
      .projects-sidebar{position:static}
      .container{padding:20px 15px}
    }

    /* Styles pour la section d√©tach√©e des comp√©tences */
    .skills-detached {
      max-width: 900px;
      margin: 60px auto 0 auto;
      background: linear-gradient(145deg,#ffffff,#f8f8f8);
      border-radius: 16px;
      padding: 45px;
      border: 1px solid rgba(184,134,11,0.15);
      box-shadow: 0 10px 40px rgba(0,0,0,0.08);
    }
    .skills-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 28px 32px;
      justify-content: center;
      align-items: start;
    }
    .skill-block {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      min-width: 160px;
    }
    .skill-tag {
      background: linear-gradient(135deg,#ffffff,#f5f5f5);
      color: #444444;
      padding: 12px 20px;
      border-radius: 20px;
      border: 1px solid rgba(200,200,200,0.5);
      transition: all 0.3s;
      font-size: 0.95em;
      font-weight: 400;
      letter-spacing: 0.3px;
      margin-bottom: 0;
      cursor: pointer;
    }
    .skill-bar {
      width: 100%;
      height: 10px;
      background: linear-gradient(90deg,#f5f5f5 60%,#e8e8e8 100%);
      border-radius: 6px;
      border: 1px solid #e0e0e0;
      overflow: hidden;
      margin-top: 2px;
      box-shadow: 0 1px 4px rgba(184,134,11,0.07);
    }
    .skill-bar-fill {
      height: 100%;
      background: linear-gradient(90deg,#b8860b 60%,#8b6914 100%);
      border-radius: 6px 0 0 6px;
      transition: width 1s cubic-bezier(.77,0,.18,1);
    }
    .skill-tooltip {
      display: none;
      position: absolute;
      left: 50%;
      top: 110%;
      transform: translateX(-50%);
      min-width: 220px;
      background: #fffbe6;
      color: #8b6914;
      border: 1px solid #b8860b;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(184,134,11,0.12);
      padding: 18px 22px;
      font-size: 1em;
      font-family: 'Inter',sans-serif;
      font-weight: 400;
      z-index: 100;
      white-space: normal;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .skill-block:hover .skill-tooltip {
      display: block;
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 class="title">{{ title }}</h1>
      <p class="subtitle">Portfolio de projets cybers√©curit√© & d√©veloppement</p>
    </div>
    
    <div class="nav">
      <a href="/" class="nav-link">‚Üê Retour au terminal</a>
    </div>

    <div class="projects-layout">
      <div class="projects-sidebar">
        <h3 class="sidebar-title">üìÇ Mes Projets</h3>
        <ul class="project-list">
          <li class="project-item active" data-project="portfolio">
            <div class="project-name">Portfolio Cyber</div>
            <div class="project-type">Web App</div>
          </li>
          <li class="project-item" data-project="jardin">
            <div class="project-name">Jardin de Cocagne</div>
            <div class="project-type">Application web responsive</div>
          </li>
          <!-- Nouveau projet : Pr√©vision consommation √©nergie -->
          <li class="project-item" data-project="energie">
            <div class="project-name">Pr√©vision consommation √©nergie</div>
            <div class="project-type">Python / Data Science</div>
          </li>
          <!-- Nouveau projet : WebGL Demo -->
          <li class="project-item" data-project="webgl">
            <div class="project-name">WebGL Demo</div>
            <div class="project-type">3D / WebGL</div>
          </li>
        </ul>
      </div>

      <div class="project-content">
        <div class="content-project active" id="portfolio">
          <h2 class="content-title">
            <span class="content-icon">üõ°Ô∏è</span>
            Portfolio Cyber
          </h2>
          <div class="content-meta">
            <span class="meta-item">Symfony</span>
            <span class="meta-item">Docker</span>
            <span class="meta-item">Terminal UI</span>
            <span class="meta-item">PHP</span>
          </div>
          <div class="content-description">
            Portfolio interactif avec mini-terminal et section CTF cach√©e. 
            D√©monstration de comp√©tences en d√©veloppement web s√©curis√© avec une 
            approche moderne utilisant Symfony 7 et une containerisation Docker.
          </div>
          <div class="content-features">
            <h4 class="features-title">Fonctionnalit√©s</h4>
            <ul class="features-list">
              <li>Interface terminal interactive avec commandes personnalis√©es</li>
              <li>Section CTF cach√©e accessible via commandes sp√©ciales</li>
              <li>Architecture dockeris√©e pour un d√©ploiement facile</li>
              <li>Design responsive et moderne</li>
            </ul>
          </div>
          <div class="content-links">
            <a href="/ctf/login" class="content-link">üéØ Acc√©der au CTF</a>
            <a href="#" class="content-link">üìÇ Code source</a>
          </div>
        </div>

        <div class="content-project" id="jardin">
          <h2 class="content-title">
            <span class="content-icon">üåø</span>
            Jardin de Cocagne
          </h2>
          <div class="content-meta">
            <span class="meta-item">Symfony</span>
            <span class="meta-item">API REST</span>
            <span class="meta-item">Responsive</span>
            <span class="meta-item">JavaScript</span>
            <span class="meta-item">PostgreSQL</span>
          </div>
          <div class="content-description">
            Application web responsive sous format d'un site web pour le jardin de Cocagne, 
            projet fictif scolaire dans le cadre d'un projet de fin de formation.
          </div>
          <div class="content-features">
            <h4 class="features-title">Fonctionnalit√©s</h4>
            <ul class="features-list">
              <li>Gestion des utilisateurs et des r√¥les</li>
              <li>Commande de panier</li>
              <li>Affichage des livraisons et calcul d'itin√©raire</li>
              <li>Design responsive adapt√© aux mobiles et tablettes</li>
              <li>Gestion d'abonnement (cr√©ation, composition, prix)</li>
              <li>Int√©gration d'une carte interactive pour localiser les d√©pots</li>
            </ul>
          </div>
          <div class="content-links">
            <a href="#" class="content-link">üìÇ Code source</a>
          </div>
        </div>

        <div class="content-project" id="energie">
          <h2 class="content-title">
            <span class="content-icon">‚ö°</span>
            Pr√©vision consommation √©nergie
          </h2>
          <div class="content-meta">
            <span class="meta-item">Python</span>
            <span class="meta-item">Tkinter</span>
            <span class="meta-item">K plus proches voisins</span>
            <span class="meta-item">Data Science</span>
          </div>
          <div class="content-description">
            Application Python permettant de pr√©voir la consommation √©lectrique moyenne √† partir de donn√©es historiques, en utilisant l'algorithme des k plus proches voisins (KNN). Interface graphique r√©alis√©e avec Tkinter pour une exp√©rience utilisateur simple et interactive.
          </div>
          <div class="content-features">
            <h4 class="features-title">Fonctionnalit√©s</h4>
            <ul class="features-list">
              <li>Lecture et traitement de fichiers CSV de consommation</li>
              <li>Calcul de la distance euclidienne entre points de donn√©es</li>
              <li>Pr√©vision par K plus proches voisins (KNN)</li>
              <li>Interface graphique avec saisie des param√®tres et affichage du r√©sultat</li>
              <li>Gestion des dates, temp√©ratures et ann√©es bissextiles</li>
            </ul>
          </div>
          <div class="content-links">
            <a href="https://github.com/MattheoCo/projet-energie" class="content-link" target="_blank">üîó Voir sur GitHub</a>
          </div>
          <div class="content-code">
            <h4 class="features-title">Extrait de code principal</h4>
            <pre style="background:#f8f8f8;border-radius:8px;padding:18px 12px;font-size:0.95em;overflow-x:auto;max-width:100%;color:#222;">
import tkinter as tk
# ...
def kPlusProches(k, point, donnees):
    voisins = []
    for i in range(len(donnees)):
        d = distance(point, donnees[i])
        voisins.append((d, i))
    voisins.sort()
    return [voisins[j] for j in range(k)]

def PuissanceMoyenne(tri_tuples):
    tableau_original = lecture('jeuTests.csv')
    somme = 0
    for i in range(len(tri_tuples)):
        somme += float(tableau_original[tri_tuples[i][1]][1])
    return somme / len(tri_tuples)
# ...
            </pre>
          </div>
        </div>

        <div class="content-project" id="webgl">
          <h2 class="content-title">
            <span class="content-icon">üéÆ</span>
            WebGL Demo
          </h2>
          <div class="content-meta">
            <span class="meta-item">WebGL</span>
            <span class="meta-item">3D</span>
            <span class="meta-item">JavaScript</span>
          </div>
          <div class="content-description">
            D√©mo 3D WebGL interactive avec √Æle flottante, oc√©an, arbre et barque. Explorez la sc√®ne avec votre souris et profitez du cycle jour/nuit.
          </div>
          <div class="webgl-stage" aria-label="Zone d'aper√ßu WebGL">
            <!-- Menu de chargement -->
            <div class="webgl-loader-overlay" id="webglLoaderMenu">
              <div class="webgl-loader-icon">üèùÔ∏è</div>
              <h3 class="webgl-loader-title">Sc√®ne 3D Interactive</h3>
              <p style="color:#666;margin-bottom:10px;font-size:1.05em;">
                √éle flottante ‚Ä¢ Oc√©an anim√© ‚Ä¢ Cycle jour/nuit
              </p>
              <div class="webgl-loader-warning">
                <span class="webgl-loader-warning-icon">‚ö†Ô∏è</span>
                <strong>Avertissement :</strong> Cette sc√®ne 3D utilise WebGL et peut √™tre gourmande en ressources.
                Elle peut ne pas fonctionner correctement sur des ordinateurs anciens ou des configurations limit√©es.
              </div>
              <button class="webgl-load-button" id="loadWebglButton">
                üöÄ Charger la sc√®ne 3D
              </button>
            </div>
            <div class="webgl-stage-placeholder">Chargement...</div>
          </div>
          <div class="content-links">
            <a href="#" class="content-link">üìÇ Code source (√† venir)</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Section √† part pour les comp√©tences -->
  <div class="skills-section skills-detached">
    <h2 class="skills-title">üîß Technologies & Comp√©tences g√©n√©rales</h2>
    <div class="skills-grid">
      <div class="skill-block" data-skill="Symfony">
        <span class="skill-tag">Symfony</span>
        <div class="skill-bar"><div class="skill-bar-fill" style="width: 85%"></div></div>
        <div class="skill-tooltip">Projet Portfolio Cyber : backend s√©curis√©, routing avanc√©, CTF cach√©.</div>
      </div>
      <div class="skill-block" data-skill="Python">
        <span class="skill-tag">Python</span>
        <div class="skill-bar"><div class="skill-bar-fill" style="width: 80%"></div></div>
        <div class="skill-tooltip">Projet OSINT : scripts d'automatisation, analyse de donn√©es, scraping web.</div>
      </div>
      <div class="skill-block" data-skill="Docker">
        <span class="skill-tag">Docker</span>
        <div class="skill-bar"><div class="skill-bar-fill" style="width: 70%"></div></div>
        <div class="skill-tooltip">Tous mes projets sont dockeris√©s pour la portabilit√© et la s√©curit√©.</div>
      </div>
      <div class="skill-block" data-skill="Linux">
        <span class="skill-tag">Linux</span>
        <div class="skill-bar"><div class="skill-bar-fill" style="width: 75%"></div></div>
        <div class="skill-tooltip">CTF Linux : challenges, scripts bash, gestion de serveurs.</div>
      </div>
      <div class="skill-block" data-skill="OSINT">
        <span class="skill-tag">OSINT</span>
        <div class="skill-bar"><div class="skill-bar-fill" style="width: 60%"></div></div>
        <div class="skill-tooltip">Projet OSINT : collecte d'informations, investigation num√©rique.</div>
      </div>
    </div>
  </div>

  <script>
    // Navigation entre projets
    const projectItems = document.querySelectorAll('.project-item');
    const contentProjects = document.querySelectorAll('.content-project');
    
    projectItems.forEach(item => {
      item.addEventListener('click', () => {
        const projectId = item.dataset.project;
        
        // Supprimer active de tous les √©l√©ments
        projectItems.forEach(i => i.classList.remove('active'));
        contentProjects.forEach(p => p.classList.remove('active'));
        
        // Ajouter active aux √©l√©ments s√©lectionn√©s
        item.classList.add('active');
        document.getElementById(projectId).classList.add('active');
      });
    });

    // Ajout : Affichage du projet √©nergie au survol de la comp√©tence Python
    const pythonSkill = document.querySelector('.skill-block[data-skill="Python"]');
    if (pythonSkill) {
      pythonSkill.querySelector('.skill-tooltip').innerHTML =
        "Projet pr√©vision √©nergie : <br>Pr√©diction de consommation √©lectrique par K plus proches voisins (<a href='https://github.com/MattheoCo/projet-energie' target='_blank'>voir GitHub</a>).";
    }
  </script>
  
  
  <script type="module">
    // Sc√®ne WebGL 3D compl√®te : √Æle volante textur√©e + arbre + ruisseau r√©fl√©chissant + cycle jour/nuit adaptatif
    console.log('üöÄ WebGL module starting...');
    
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { Water } from 'three/addons/objects/Water.js';
    import { Sky } from 'three/addons/objects/Sky.js';

    console.log('‚úÖ All modules loaded', THREE);

    window.webglInitialized = false;

    // Gestionnaire du bouton de chargement
    const loadButton = document.getElementById('loadWebglButton');
    const loaderOverlay = document.getElementById('webglLoaderMenu');
    
    if (loadButton) {
      loadButton.addEventListener('click', () => {
        console.log('üé¨ User clicked load button');
        // Masquer le menu
        loaderOverlay.classList.add('hidden');
        // Lancer l'initialisation WebGL
        setTimeout(initWebGL, 100);
      });
    }

    function initWebGL() {
      console.log('üé¨ initWebGL called');
      if (window.webglInitialized) {
        console.log('‚è≠Ô∏è Already initialized');
        return;
      }
      const stage = document.querySelector('#webgl .webgl-stage');
      if (!stage) {
        console.error('‚ùå Stage not found');
        return;
      }
      console.log('‚úÖ Stage found', stage);
      window.webglInitialized = true;

      stage.innerHTML = '';

      const width = stage.clientWidth;
      const height = stage.clientHeight;

      // === RENDERER ===
      const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.setSize(width, height);
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      renderer.toneMapping = THREE.ACESFilmicToneMapping;
      renderer.toneMappingExposure = 0.5;
      stage.appendChild(renderer.domElement);

      // === SCENE & CAMERA ===
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(60, width / height, 0.1, 1000);
      camera.position.set(8, 5, 10);

      // === ORBIT CONTROLS (d√©placement souris fluide) ===
      const controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;
      controls.target.set(0, 1, 0);
      controls.minDistance = 4;
      controls.maxDistance = 30;
      controls.maxPolarAngle = Math.PI / 2 + 0.3;
      controls.enablePan = false;

      // === DETECTION THEME UTILISATEUR (light/dark) ===
      const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      
      // === CYCLE JOUR/NUIT ADAPTATIF ===
      let dayNightCycle = isDarkMode ? 0.4 : 0.8; // 0=nuit, 1=jour (plus lumineux)
      const sun = new THREE.Vector3();

      // Sky shader
      const sky = new Sky();
      sky.scale.setScalar(450);
      scene.add(sky);

      const skyUniforms = sky.material.uniforms;
      skyUniforms['turbidity'].value = 10;
      skyUniforms['rayleigh'].value = isDarkMode ? 1.5 : 3; // Plus lumineux
      skyUniforms['mieCoefficient'].value = 0.005;
      skyUniforms['mieDirectionalG'].value = 0.8;

      function updateSun() {
        const theta = Math.PI * (dayNightCycle - 0.5);
        const phi = 2 * Math.PI * 0.25;
        sun.setFromSphericalCoords(1, phi, theta);
        skyUniforms['sunPosition'].value.copy(sun);
        
        // Ajuster la lumi√®re directionnelle
        dirLight.position.copy(sun).multiplyScalar(50);
        dirLight.intensity = Math.max(0.5, dayNightCycle * 1.5); // Plus intense
        
        // Couleur ambiante adapt√©e
        const ambientIntensity = isDarkMode ? 0.5 : 0.7; // Plus lumineux
        hemiLight.intensity = ambientIntensity + dayNightCycle * 0.4;
        
        // Exposition tonemap
        renderer.toneMappingExposure = isDarkMode ? 0.7 : 0.9 + dayNightCycle * 0.2; // Plus lumineux
      }

      // Lumi√®re h√©misph√®re
      const hemiLight = new THREE.HemisphereLight(0xffffff, 0xb89968, 0.8); // Plus lumineux
      scene.add(hemiLight);

      // Lumi√®re directionnelle (soleil) - positionn√©e √† droite
      const dirLight = new THREE.DirectionalLight(0xffffff, 1.2); // Plus intense
      dirLight.position.set(15, 10, 5); // Position √† droite pour ombres vers la gauche
      dirLight.castShadow = true;
      dirLight.shadow.camera.left = -15;
      dirLight.shadow.camera.right = 15;
      dirLight.shadow.camera.top = 15;
      dirLight.shadow.camera.bottom = -15;
      dirLight.shadow.mapSize.set(2048, 2048);
      dirLight.shadow.bias = -0.0001;
      scene.add(dirLight);

      updateSun();

      // === √éLE FLOTTANTE TEXTUR√âE ===
      // Socle rocheux (cone invers√© avec texture proc√©durale)
      const rockGeo = new THREE.ConeGeometry(3.5, 5.5, 12, 4);
      rockGeo.rotateX(Math.PI);
      rockGeo.translate(0, -2.2, 0);
      
      // Perturbation g√©om√©trique pour aspect rocheux
      const rockPos = rockGeo.attributes.position;
      for (let i = 0; i < rockPos.count; i++) {
        const x = rockPos.getX(i);
        const y = rockPos.getY(i);
        const z = rockPos.getZ(i);
        const noise = (Math.sin(x * 3 + y * 2) + Math.cos(z * 3 + y)) * 0.12;
        rockPos.setX(i, x + noise * Math.sign(x));
        rockPos.setZ(i, z + noise * Math.sign(z));
      }
      rockPos.needsUpdate = true;
      rockGeo.computeVertexNormals();

      const rockMat = new THREE.MeshStandardMaterial({
        color: 0x8b6f47,
        roughness: 0.95,
        metalness: 0.05,
        flatShading: false
      });
      const islandBase = new THREE.Mesh(rockGeo, rockMat);
      islandBase.castShadow = true;
      islandBase.receiveShadow = true;
      scene.add(islandBase);

      // Plage de sable (terrain avec relief) - forme circulaire
      const terrainGeo = new THREE.CircleGeometry(3.5, 64);
      terrainGeo.rotateX(-Math.PI / 2);
      
      const terrainPos = terrainGeo.attributes.position;
      for (let i = 0; i < terrainPos.count; i++) {
        const x = terrainPos.getX(i);
        const z = terrainPos.getZ(i);
        const r = Math.sqrt(x * x + z * z);
        
        // Relief doux de plage qui diminue vers les bords
        const height = 0.3 * Math.exp(-(r * r) / 20) 
                     + 0.08 * Math.sin(x * 2) * Math.cos(z * 2)
                     + 0.05 * Math.sin(x * 4.5 + z * 3.1);
        terrainPos.setY(i, height);
      }
      terrainPos.needsUpdate = true;
      terrainGeo.computeVertexNormals();

      // Texture sable proc√©durale
      const sandCanvas = document.createElement('canvas');
      sandCanvas.width = sandCanvas.height = 512;
      const sandCtx = sandCanvas.getContext('2d');
      
      // D√©grad√© radial de sable dor√©
      const sandGrad = sandCtx.createRadialGradient(256, 256, 50, 256, 256, 256);
      sandGrad.addColorStop(0, '#f4e4c1');
      sandGrad.addColorStop(0.5, '#e8d4a8');
      sandGrad.addColorStop(1, '#d9c291');
      sandCtx.fillStyle = sandGrad;
      sandCtx.fillRect(0, 0, 512, 512);
      
      // Grains de sable (bruit)
      for (let i = 0; i < 12000; i++) {
        const x = Math.random() * 512;
        const y = Math.random() * 512;
        const shade = Math.random() > 0.5 ? 'rgba(0,0,0,0.03)' : 'rgba(255,255,255,0.06)';
        sandCtx.fillStyle = shade;
        sandCtx.fillRect(x, y, 1, 1);
      }
      
      const sandTexture = new THREE.CanvasTexture(sandCanvas);
      sandTexture.wrapS = sandTexture.wrapT = THREE.RepeatWrapping;
      sandTexture.repeat.set(3, 3);

      const terrainMat = new THREE.MeshStandardMaterial({
        map: sandTexture,
        roughness: 0.95,
        metalness: 0
      });
      const terrain = new THREE.Mesh(terrainGeo, terrainMat);
      terrain.position.y = -0.75; // Encore plus bas
      terrain.castShadow = true;
      terrain.receiveShadow = true;
      scene.add(terrain);

      // === ARBRE SIMPLE ===
      // === ARBRE SIMPLE ===
      // Tronc avec texture √©corce
      const trunkCanvas = document.createElement('canvas');
      trunkCanvas.width = 128;
      trunkCanvas.height = 256;
      const trunkCtx = trunkCanvas.getContext('2d');
      const trunkGrad = trunkCtx.createLinearGradient(0, 0, 0, 256);
      trunkGrad.addColorStop(0, '#3d2817');
      trunkGrad.addColorStop(0.5, '#5c3d2e');
      trunkGrad.addColorStop(1, '#4a2f1f');
      trunkCtx.fillStyle = trunkGrad;
      trunkCtx.fillRect(0, 0, 128, 256);
      
      // Lignes verticales d'√©corce
      trunkCtx.strokeStyle = 'rgba(0,0,0,0.4)';
      trunkCtx.lineWidth = 2;
      for (let i = 0; i < 15; i++) {
        trunkCtx.beginPath();
        trunkCtx.moveTo(Math.random() * 128, 0);
        trunkCtx.lineTo(Math.random() * 128, 256);
        trunkCtx.stroke();
      }
      
      const trunkTexture = new THREE.CanvasTexture(trunkCanvas);
      const trunkGeo = new THREE.CylinderGeometry(0.15, 0.22, 2.5, 12);
      const trunkMat = new THREE.MeshStandardMaterial({
        map: trunkTexture,
        roughness: 0.95,
        metalness: 0
      });
      const trunk = new THREE.Mesh(trunkGeo, trunkMat);
      trunk.position.set(0.3, 0.55, -0.2);
      trunk.castShadow = true;
      trunk.receiveShadow = true;
      scene.add(trunk);

      // Feuillage simple (sph√®re)
      const foliageGroup = new THREE.Group();
      const leafMat = new THREE.MeshStandardMaterial({
        color: isDarkMode ? 0x2d5016 : 0x4a8c2a,
        roughness: 0.7,
        metalness: 0
      });
      
      // Couronne principale
      const mainFoliage = new THREE.Mesh(new THREE.SphereGeometry(1.2, 16, 16), leafMat);
      mainFoliage.position.set(0, 0, 0);
      mainFoliage.castShadow = true;
      mainFoliage.receiveShadow = true;
      foliageGroup.add(mainFoliage);
      
      // Feuilles additionnelles pour volume
      const leaf2 = new THREE.Mesh(new THREE.SphereGeometry(0.8, 12, 12), leafMat);
      leaf2.position.set(-0.7, 0.2, 0.5);
      leaf2.castShadow = true;
      foliageGroup.add(leaf2);
      
      const leaf3 = new THREE.Mesh(new THREE.SphereGeometry(0.75, 12, 12), leafMat);
      leaf3.position.set(0.8, 0.1, -0.4);
      leaf3.castShadow = true;
      foliageGroup.add(leaf3);

      foliageGroup.position.set(trunk.position.x, trunk.position.y + 1.6, trunk.position.z);
      scene.add(foliageGroup);

      // === OC√âAN INFINI AUTOUR DE L'√éLE ===
      const waterNormals = new THREE.TextureLoader().load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/waternormals.jpg', (tex) => {
        tex.wrapS = tex.wrapT = THREE.RepeatWrapping;
      });

      // Grand plan d'eau pour simuler l'oc√©an avec reflets
      const oceanGeo = new THREE.PlaneGeometry(200, 200, 256, 256);
      const ocean = new Water(oceanGeo, {
        textureWidth: 2048,
        textureHeight: 2048,
        waterNormals: waterNormals,
        sunDirection: sun.clone().normalize(),
        sunColor: 0xffffff,
        waterColor: isDarkMode ? 0x0d2a47 : 0x4a90c2,
        distortionScale: 2.5,
        fog: false,
        alpha: 0.9 // Plus de transparence pour voir les reflets
      });
      ocean.rotation.x = -Math.PI / 2;
      ocean.position.y = -0.8; // Sous l'√Æle
      scene.add(ocean);

      // === BARQUE EN BOIS ===
      const boatGroup = new THREE.Group();
      
      // Texture bois pour la barque
      const boatWoodCanvas = document.createElement('canvas');
      boatWoodCanvas.width = 512;
      boatWoodCanvas.height = 512;
      const boatWoodCtx = boatWoodCanvas.getContext('2d');
      const boatGrad = boatWoodCtx.createLinearGradient(0, 0, 0, 512);
      boatGrad.addColorStop(0, '#8b6f47');
      boatGrad.addColorStop(0.5, '#6b5433');
      boatGrad.addColorStop(1, '#7a5c3a');
      boatWoodCtx.fillStyle = boatGrad;
      boatWoodCtx.fillRect(0, 0, 512, 512);
      // Lignes de planches
      boatWoodCtx.strokeStyle = 'rgba(50, 30, 10, 0.3)';
      boatWoodCtx.lineWidth = 2;
      for (let i = 0; i < 512; i += 40) {
        boatWoodCtx.beginPath();
        boatWoodCtx.moveTo(0, i);
        boatWoodCtx.lineTo(512, i);
        boatWoodCtx.stroke();
      }
      const boatWoodTexture = new THREE.CanvasTexture(boatWoodCanvas);
      boatWoodTexture.wrapS = boatWoodTexture.wrapT = THREE.RepeatWrapping;
      
      const boatWoodMat = new THREE.MeshStandardMaterial({
        map: boatWoodTexture,
        roughness: 0.8,
        metalness: 0,
        color: 0xa0826d
      });

      // Coque principale (forme de bateau)
      const hullGeo = new THREE.BoxGeometry(2, 0.3, 0.8);
      const hull = new THREE.Mesh(hullGeo, boatWoodMat);
      hull.castShadow = true;
      hull.receiveShadow = true;
      boatGroup.add(hull);

      // Avant du bateau (pointu)
      const bowGeo = new THREE.ConeGeometry(0.4, 0.6, 4);
      const bow = new THREE.Mesh(bowGeo, boatWoodMat);
      bow.rotation.z = -Math.PI / 2;
      bow.position.set(1.3, 0, 0);
      bow.castShadow = true;
      boatGroup.add(bow);

      // Arri√®re du bateau
      const sternGeo = new THREE.BoxGeometry(0.2, 0.35, 0.9);
      const stern = new THREE.Mesh(sternGeo, boatWoodMat);
      stern.position.set(-1.1, 0.025, 0);
      stern.castShadow = true;
      boatGroup.add(stern);

      // Banc int√©rieur
      const benchGeo = new THREE.BoxGeometry(0.6, 0.08, 0.6);
      const bench = new THREE.Mesh(benchGeo, boatWoodMat);
      bench.position.set(-0.2, 0.2, 0);
      bench.castShadow = true;
      boatGroup.add(bench);

      // Position de la barque (√† c√¥t√© de l'√Æle)
      boatGroup.position.set(5, -0.65, 3);
      boatGroup.rotation.y = Math.PI / 6; // L√©g√®re rotation
      scene.add(boatGroup);

      // Plan d'ombre sous l'√Æle qui se projette sur l'oc√©an
      const shadowPlane = new THREE.Mesh(
        new THREE.CircleGeometry(6, 32),
        new THREE.ShadowMaterial({ opacity: 0.35 }) // Ombres plus visibles
      );
      shadowPlane.rotation.x = -Math.PI / 2;
      shadowPlane.position.y = -0.75; // Juste au-dessus de l'oc√©an
      shadowPlane.receiveShadow = true;
      scene.add(shadowPlane);

      // === ANIMATION ===
      const clock = new THREE.Clock();
      let autoRotate = true;

      function animate() {
        const elapsed = clock.getElapsedTime();

        // Oscillation flottante de l'√Æle (tout l'ensemble bouge ensemble)
        const floatOffset = Math.sin(elapsed * 0.5) * 0.06;
        islandBase.position.y = floatOffset - 1.5; // √éle encore plus basse
        terrain.position.y = floatOffset - 0.75; // Plage de sable encore plus basse
        trunk.position.y = terrain.position.y + 1.3; // Tronc arbre sur le sable
        foliageGroup.position.y = trunk.position.y + 1.6; // Feuillage au sommet
        shadowPlane.position.y = floatOffset - 1.6; // Ombre suit l'√Æle

        // Animation oc√©an (vagues continues avec reflets)
        ocean.material.uniforms['time'].value = elapsed * 0.4;

        // Animation de la barque (flottement sur l'eau)
        boatGroup.position.y = -0.65 + Math.sin(elapsed * 0.8 + 2) * 0.04; // Flottement vertical
        boatGroup.rotation.z = Math.sin(elapsed * 0.6) * 0.03; // Balancement lat√©ral
        boatGroup.rotation.x = Math.cos(elapsed * 0.7) * 0.02; // Balancement avant/arri√®re

        // Mouvement doux du feuillage dans le vent
        foliageGroup.rotation.y = Math.sin(elapsed * 0.4) * 0.05;
        foliageGroup.rotation.z = Math.cos(elapsed * 0.5) * 0.03;

        // Cycle jour/nuit progressif (optionnel: animation lente)
        // dayNightCycle = 0.5 + 0.3 * Math.sin(elapsed * 0.1);
        // updateSun();

        controls.update();
        renderer.render(scene, camera);
        requestAnimationFrame(animate);
      }
      animate();

      // Resize responsive
      function onResize() {
        const w = stage.clientWidth;
        const h = stage.clientHeight;
        renderer.setSize(w, h);
        camera.aspect = w / h;
        camera.updateProjectionMatrix();
      }
      window.addEventListener('resize', onResize);

      // Basculer le cycle jour/nuit au clic (optionnel)
      stage.addEventListener('dblclick', () => {
        dayNightCycle = dayNightCycle > 0.5 ? 0.15 : 0.85;
        updateSun();
      });
    }

    // Note: L'initialisation WebGL se fait maintenant uniquement via le bouton de chargement
    console.log('‚úÖ WebGL ready to load on user demand');
  </script>
</body>
</html>
